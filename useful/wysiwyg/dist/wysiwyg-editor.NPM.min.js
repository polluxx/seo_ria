(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],function(b){return a(window,document,navigator,b)})}else{if(typeof exports!=="undefined"){module.exports=a(window,document,navigator,require("jquery"))}else{return a(window,document,navigator,jQuery)}}}(function(l,t,a,e,f){var d=function(E,D,B){var C;return function(){if(C){if(!B){return}clearTimeout(C)}var G=this,F=arguments;C=setTimeout(function(){C=null;E.apply(G,F)},D)}};var u=function(C,E,D,B){if(C.addEventListener){C.addEventListener(E,D,B?true:false)}else{if(C.attachEvent){C.attachEvent("on"+E,D)}else{if(C!=l){C["on"+E]=D}}}};var w=function(C,E,D,B){if(C.removeEventListener){C.removeEventListener(E,D,B?true:false)}else{if(C.detachEvent){C.detachEvent("on"+E,D)}else{if(C!=l){C["on"+E]=null}}}};var A=function(D,E,C,B){if(t.createEvent){var F=t.createEvent("Event");F.initEvent(E,C!==f?C:true,B!==f?B:false);D.dispatchEvent(F)}else{if(t.createEventObject){var F=t.createEventObject();D.fireEvent("on"+E,F)}else{if(typeof(D["on"+E])=="function"){D["on"+E]()}}}};var x=function(B){if(B.preventDefault){B.preventDefault()}else{B.returnValue=false}if(B.stopPropagation){B.stopPropagation()}else{B.cancelBubble=true}return false};var q=typeof(Node)!="undefined"?Node.ELEMENT_NODE:1;var i=typeof(Node)!="undefined"?Node.TEXT_NODE:3;var o=function(B,C){var D=C;while(D){if(D===B){return true}D=D.parentNode}return false};var c=function(C,B){if(C.firstChild){return C.firstChild}while(C){if(C==B){return null}if(C.nextSibling){return C.nextSibling}C=C.parentNode}return null};var s=function(B){if(l.getSelection){var C=l.getSelection();if(C.rangeCount>0){return C.getRangeAt(0)}}else{if(t.selection){var C=t.selection;return C.createRange()}}return null};var n=function(B,D){if(!D){return}if(l.getSelection){var C=l.getSelection();C.removeAllRanges();C.addRange(D)}else{if(t.selection){D.select()}}};var k=function(){if(l.getSelection){var D=l.getSelection();if(!D.rangeCount){return false}var B=D.getRangeAt(0).cloneRange();if(B.getBoundingClientRect){var C=B.getBoundingClientRect();if(!C||(C.left==0&&C.top==0&&C.right==0&&C.bottom==0)){return false}return{left:parseInt(C.left),top:parseInt(C.top),width:parseInt(C.right-C.left),height:parseInt(C.bottom-C.top)}}}else{if(t.selection){var D=t.selection;if(D.type!="Control"){var B=D.createRange();return{left:B.boundingLeft,top:B.boundingTop,width:B.boundingWidth,height:B.boundingHeight}}}}return false};var j=function(C){if(l.getSelection){var E=l.getSelection();if(E.isCollapsed){return true}return false}else{if(t.selection){var E=t.selection;if(E.type=="Text"){var D=t.selection.createRange();var B=t.body.createTextRange();B.moveToElementText(C);B.setEndPoint("EndToStart",D);return D.htmlText.length==0}if(E.type=="Control"){return false}}}return true};var m=function(F){if(l.getSelection){var D=l.getSelection();if(!D.rangeCount){return[]}var C=[];for(var J=0;J<D.rangeCount;++J){var L=D.getRangeAt(J),E=L.startContainer,M=L.endContainer;while(E){if(E!=F){var N=false;if(D.containsNode){N=D.containsNode(E,true)}else{var I=t.createRange();I.selectNodeContents(E);for(var J=0;J<D.rangeCount;++J){var L=D.getRangeAt(J);if(L.compareBoundaryPoints(L.END_TO_START,I)>=0&&L.compareBoundaryPoints(L.START_TO_END,I)<=0){N=true;break}}}if(N){C.push(E)}}E=c(E,E==M?M:F)}}if(C.length==0&&o(F,D.focusNode)&&D.focusNode!=F){C.push(D.focusNode)}return C}else{if(t.selection){var D=t.selection;if(D.type=="Text"){var C=[];var B=D.createRangeCollection();for(var J=0;J<B.length;++J){var L=B[J],K=L.parentElement(),E=K;while(E){var I=L.duplicate();I.moveToElementText(E.nodeType!=q?E.parentNode:E);if(I.compareEndPoints("EndToStart",L)>=0&&I.compareEndPoints("StartToEnd",L)<=0){var H=false;for(var G=0;G<C.length;++G){if(C[G]!==E){continue}H=true;break}if(!H){C.push(E)}}E=c(E,K)}}if(C.length==0&&o(F,t.activeElement)&&t.activeElement!=F){C.push(t.activeElement)}return C}if(D.type=="Control"){var C=[];var L=D.createRange();for(var J=0;J<L.length;++J){C.push(L(J))}return C}}}return[]};var h=function(){if(l.getSelection){var C=l.getSelection();if(!C.isCollapsed){try{C.collapseToEnd()
}catch(D){}}}else{if(t.selection){var C=t.selection;if(C.type!="Control"){var B=C.createRange();B.collapse(false);B.select()}}}};var v=function(C){if(j(C)){return null}if(l.getSelection){var H=l.getSelection();if(H.rangeCount){var D=t.createElement("div"),B=H.rangeCount;for(var F=0;F<B;++F){var G=H.getRangeAt(F).cloneContents();D.appendChild(G)}return D.innerHTML}}else{if(t.selection){var H=t.selection;if(H.type=="Text"){var E=H.createRange();return E.htmlText}}}return null};var p=function(B,F){if(l.getSelection){var E=l.getSelection();if(o(B,E.anchorNode)&&o(B,E.focusNode)){return true}if(!F){return false}var C=t.createRange();C.selectNodeContents(B);C.collapse(false);E.removeAllRanges();E.addRange(C)}else{if(t.selection){var E=t.selection;if(E.type=="Control"){var C=E.createRange();if(C.length!=0&&o(B,C(0))){return true}}else{var D=t.body.createTextRange();D.moveToElementText(B);var C=E.createRange();if(D.inRange(C)){return true}}if(!F){return false}var C=t.body.createTextRange();C.moveToElementText(B);C.setEndPoint("StartToEnd",C);C.select()}}return true};var y=function(F,H){if(l.getSelection){var C=l.getSelection();if(C.getRangeAt&&C.rangeCount){var I=C.getRangeAt(0);var D=t.createElement("div");D.innerHTML=H;var J=t.createDocumentFragment(),E,B;while((E=D.firstChild)){B=J.appendChild(E)}if(o(F,I.commonAncestorContainer)){I.deleteContents();I.insertNode(J)}else{F.appendChild(J)}if(B){I=I.cloneRange();I.setStartAfter(B);I.collapse(true);C.removeAllRanges();C.addRange(I)}}}else{if(t.selection){var C=t.selection;if(C.type!="Control"){var G=C.createRange();G.collapse(true);var I=C.createRange();if(o(F,I.parentElement())){I.pasteHTML(H)}else{var K=t.body.createTextRange();K.moveToElementText(F);K.collapse(false);K.select();K.pasteHTML(H)}I=C.createRange();I.setEndPoint("StartToEnd",G);I.select()}}}};var b=function(aa){aa=aa||{};var U=aa.element||null;if(typeof(U)=="string"){U=t.getElementById(U)}var ag=aa.onkeypress||null;var S=aa.onselection||null;var ab=aa.onplaceholder||null;var ad=aa.hijackcontextmenu||false;var R=U.nodeName=="TEXTAREA"||U.nodeName=="INPUT";if(R){var Z="contentEditable" in t.body;if(Z){var I=a.userAgent.match(/(?:iPad|iPhone|Android).* AppleWebKit\/([^ ]+)/);if(I&&420<=parseInt(I[1])&&parseInt(I[1])<534){Z=false}}if(!Z){var L=U;var ae=function(am){return am.replace(/<br[ \/]*>\n?/gi,"<br>\n")};L.value=ae(L.value);var aj=function(){return this};var D=function(){return null};return{legacy:true,getElement:function(){return L},getHTML:function(){return L.value},setHTML:function(am){L.value=ae(am);return this},getSelectedHTML:D,sync:aj,collapseSelection:aj,openPopup:D,closePopup:aj,removeFormat:aj,bold:aj,italic:aj,underline:aj,strikethrough:aj,forecolor:aj,highlight:aj,fontName:aj,fontSize:aj,subscript:aj,superscript:aj,align:aj,format:aj,indent:aj,insertLink:aj,insertImage:aj,insertHTML:aj,insertList:aj}}}var L=null,al=null;if(R){L=U;L.style.display="none";al=t.createElement("DIV");al.innerHTML=L.value;var N=L.parentNode,C=L.nextSibling;if(C){N.insertBefore(al,C)}else{N.appendChild(al)}}else{al=U}al.setAttribute("contentEditable","true");var Q=(t.all&&!t.addEventListener)?t:l;var T=null;if(R){var J=al.innerHTML;T=function(){var am=al.innerHTML;if(am==J){return}L.value=am;J=am;A(L,"change",false)}}var Y;if(ab){var P=false;Y=function(){var ao=true;var am=al;while(am){am=c(am,al);if(!am){}else{if(am.nodeType==q){if(am.nodeName=="IMG"){ao=false;break}}else{if(am.nodeType==i){var an=am.nodeValue;if(an&&an.search(/[^\s]/)!=-1){ao=false;break}}}}}if(P!=ao){ab(ao);P=ao}};Y()}var W=null,H=null,V=null;if(S){H=function(ap,an,ay){var av=j(al);var ao=m(al);var ax=(ap===null||an===null)?null:{left:ap,top:an,width:0,height:0};var am=k();if(am){ax=am}if(ax){if(al.getBoundingClientRect){var az=al.getBoundingClientRect();ax.left-=parseInt(az.left);ax.top-=parseInt(az.top)}else{var at=al,ar=0,aq=0,au=false;do{ar+=at.offsetLeft?parseInt(at.offsetLeft):0;aq+=at.offsetTop?parseInt(at.offsetTop):0;if(at.style.position=="fixed"){au=true}}while(at=at.offsetParent);ax.left-=ar-(au?0:l.pageXOffset);ax.top-=aq-(au?0:l.pageYOffset)}if(ax.left<0){ax.left=0
}if(ax.top<0){ax.top=0}if(ax.width>al.offsetWidth){ax.width=al.offsetWidth}if(ax.height>al.offsetHeight){ax.height=al.offsetHeight}}else{if(ao.length){for(var aw=0;aw<ao.length;++aw){var at=ao[aw];if(at.nodeType!=q){continue}ax={left:at.offsetLeft,top:at.offsetTop,width:at.offsetWidth,height:at.offsetHeight};break}}}S(av,ax,ao,ay)};V=d(H,1)}var af=null;var G=function(an){if(!an){var an=l.event}var am=an.target||an.srcElement;if(am.nodeType==i){am=am.parentNode}if(o(af,am)){return}ak()};var ac=function(){if(af){return af}u(Q,"mousedown",G,true);af=t.createElement("DIV");var an=al.parentNode,am=al.nextSibling;if(am){an.insertBefore(af,am)}else{an.appendChild(af)}return af};var ak=function(){if(!af){return}af.parentNode.removeChild(af);af=null;w(Q,"mousedown",G,true)};u(al,"focus",function(){if(L){A(L,"focus",false)}});u(al,"blur",function(){if(T){T()}if(L){A(L,"blur",false)}});var E=null;if(Y||T){var F=T?d(T,250,true):null;var ah=function(am){if(Y){Y()}if(F){F()}};E=d(ah,1);u(al,"input",E);u(al,"DOMNodeInserted",E);u(al,"DOMNodeRemoved",E);u(al,"DOMSubtreeModified",E);u(al,"DOMCharacterDataModified",E);u(al,"propertychange",E);u(al,"textInput",E);u(al,"paste",E);u(al,"cut",E);u(al,"drop",E)}var M=function(ap,am){if(!ap){var ap=l.event}var an=0;if(ap.keyCode){an=ap.keyCode}else{if(ap.which){an=ap.which}}var ao=ap.charCode;if(am==1&&ag){var aq=ag(an,ao?String(String):String.fromCharCode(an),ap.shiftKey||false,ap.altKey||false,ap.ctrlKey||false,ap.metaKey||false);if(aq===false){return x(ap)}}if(am==2||am==3){W=null;if(V){V(null,null,false)}}if(am==2&&E){switch(an){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:break;default:E();break}}};u(al,"keydown",function(am){return M(am,1)});u(al,"keypress",function(am){return M(am,2)});u(al,"keyup",function(am){return M(am,3)});var ai=function(ap,am){if(!ap){var ap=l.event}var ao=null,an=null;if(ap.clientX&&ap.clientY){ao=ap.clientX;an=ap.clientY}else{if(ap.pageX&&ap.pageY){ao=ap.pageX-l.pageXOffset;an=ap.pageY-l.pageYOffset}}if(ap.which&&ap.which==3){am=true}else{if(ap.button&&ap.button==2){am=true}}w(Q,"mouseup",ai);W=null;if(!ad&&am){return}if(V){V(ao,an,am)}};u(al,"mousedown",function(am){w(Q,"mouseup",ai);u(Q,"mouseup",ai)});u(al,"mouseup",function(am){ai(am);if(E){E()}});u(al,"dblclick",function(am){ai(am)});u(al,"selectionchange",function(am){ai(am)});if(ad){u(al,"contextmenu",function(am){ai(am,true);return x(am)})}var B=function(ar,aq,ao){n(al,W);if(!p(al,ao)){return false}if(l.getSelection){try{if(t.queryCommandSupported&&!t.queryCommandSupported(ar)){return false}return t.execCommand(ar,false,aq)}catch(ap){}}else{if(t.selection){var an=t.selection;if(an.type!="None"){var am=an.createRange();try{if(!am.queryCommandEnabled(ar)){return false}return am.execCommand(ar,false,aq)}catch(ap){}}}}return false};var K=null;var O=function(){if(t.all||!!l.MSInputMethodContext){K=t.createElement("DIV");al.appendChild(K)}};var X=function(am){if(K){al.removeChild(K);K=null}if(E){E()}if(am){h();W=null}else{if(W){W=s(al)}}};return{getElement:function(){return al},getHTML:function(){return al.innerHTML},setHTML:function(am){al.innerHTML=am;X(true);return this},getSelectedHTML:function(){n(al,W);if(!p(al)){return null}return v(al)},sync:function(){if(T){T()}return this},collapseSelection:function(){h();W=null;return this},openPopup:function(){if(!W){W=s(al)}return ac()},closePopup:function(){ak();return this},removeFormat:function(){B("removeFormat");B("unlink");X();return this},bold:function(){B("bold");X();return this},italic:function(){B("italic");X();return this},underline:function(){B("underline");X();return this},strikethrough:function(){B("strikeThrough");X();return this},forecolor:function(am){B("foreColor",am);X();return this},highlight:function(am){if(!B("hiliteColor",am)){B("backColor",am)}X();return this},fontName:function(am){B("fontName",am);X();return this},fontSize:function(am){B("fontSize",am);X();return this},subscript:function(){B("subscript");X();return this},superscript:function(){B("superscript");X();return this},align:function(am){O();if(am=="left"){B("justifyLeft")
}else{if(am=="center"){B("justifyCenter")}else{if(am=="right"){B("justifyRight")}else{if(am=="justify"){B("justifyFull")}}}}X();return this},format:function(am){O();B("formatBlock",am);X();return this},indent:function(am){O();B(am?"outdent":"indent");X();return this},insertLink:function(am){B("createLink",am);X(true);return this},insertImage:function(am){B("insertImage",am,true);X(true);return this},insertHTML:function(am){if(!B("insertHTML",am,true)){n(al,W);p(al,true);y(al,am)}X(true);return this},insertList:function(am){O();B(am?"insertOrderedList":"insertUnorderedList");X();return this}}};var g=function(G,O,M){var B,H,K,F,J,D,C,N;F=Math.floor(G*6);J=G*6-F;D=M*(1-O);C=M*(1-J*O);N=M*(1-(1-J)*O);switch(F%6){case 0:B=M,H=N,K=D;break;case 1:B=C,H=M,K=D;break;case 2:B=D,H=M,K=N;break;case 3:B=D,H=C,K=M;break;case 4:B=N,H=D,K=M;break;case 5:B=M,H=D,K=C;break}var L=Math.floor(B*255).toString(16);var E=Math.floor(H*255).toString(16);var I=Math.floor(K*255).toString(16);return"#"+(L.length<2?"0":"")+L+(E.length<2?"0":"")+E+(I.length<2?"0":"")+I};var z=function(B){return B.replace(/[&<>"]/g,function(C){var D={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};return D[C]||C})};var r=function(X,Z,H,F,Y,E,O,ad,C,M,I,D,J,ab){var V=function(ag,ah){if(!ah){}else{if(ag.getSelectedHTML()){ag.insertLink(ah)}else{ag.insertHTML('<a href="'+z(ah)+'">'+z(ah)+"</a>")}}ag.closePopup().collapseSelection()};var aa=function(ag,ak){var aj=U(E);var al=e('<input type="text" value="'+(ak?ak.attr("href"):"")+'" />').addClass("wysiwyg-input").keypress(function(am){if(am.which!=10&&am.which!=13){return}if(ak){ak.attr("href",al.val());ag.closePopup().collapseSelection()}else{V(ag,al.val())}});if(ad){al.attr("placeholder",ad)}var ai=aj.click(function(am){if(ak){ak.attr("href",al.val());ag.closePopup().collapseSelection()}else{V(ag,al.val())}am.stopPropagation();am.preventDefault();return false});var ah=e("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");ah.append(al).append(ai);return ah};var T=function(ak){var ai=function(ar,aq){var at='<img id="wysiwyg-insert-image" src="" alt=""'+(aq?' title="'+z(aq)+'"':"")+" />";ak.insertHTML(at).closePopup().collapseSelection();var au=e("#wysiwyg-insert-image").removeAttr("id");if(M){au.css({maxWidth:M[0]+"px",maxHeight:M[1]+"px"}).load(function(){au.css({maxWidth:"",maxHeight:""});var aw=au.width(),av=au.height();if(aw>M[0]||av>M[1]){if((aw/av)>(M[0]/M[1])){av=parseInt(av/aw*M[0]);aw=M[0]}else{aw=parseInt(aw/av*M[1]);av=M[1]}au.attr("width",aw).attr("height",av)}})}au.attr("src",ar)};var aj=e("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");var an=null,ap=e('<input type="file" />').css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0,cursor:"pointer"});if(!D&&l.File&&l.FileReader&&l.FileList){var al=function(ar){if(!ar.type.match("image.*")){return}var aq=new FileReader();aq.onload=function(au){var at=au.target.result;ai(at,ar.name)};aq.readAsDataURL(ar)};an=ap.attr("draggable","true").change(function(at){var ar=at.target.files;for(var aq=0;aq<ar.length;++aq){al(ar[aq])}}).on("dragover",function(aq){aq.originalEvent.dataTransfer.dropEffect="copy";aq.stopPropagation();aq.preventDefault();return false}).on("drop",function(at){var ar=at.originalEvent.dataTransfer.files;for(var aq=0;aq<ar.length;++aq){al(ar[aq])}at.stopPropagation();at.preventDefault();return false})}else{if(I){var ao=ap.change(function(aq){I.call(this,ai)});an=e("<form/>").append(ao)}}if(an){e("<div/>").addClass("wysiwyg-browse").html(O).append(an).appendTo(aj)}var ag=U(E);var am=e('<input type="text" value="" />').addClass("wysiwyg-input").keypress(function(aq){if(aq.which==10||aq.which==13){ai(am.val())}});if(ad){am.attr("placeholder",ad)}var ah=ag.click(function(aq){ai(am.val());aq.stopPropagation();aq.preventDefault();return false});aj.append(e("<div/>").append(am).append(ah));return aj};var ac=function(ag){var aj=function(an,ao){an=e.trim(an||"");ao=e.trim(ao||"");var ap=false;if(an.length&&!ao.length){ap=an}else{if(ao.indexOf("<")==-1&&ao.indexOf(">")==-1&&ao.match(/^(?:https?:\/)?\/?(?:[^:\/\s]+)(?:(?:\/\w+)*\/)(?:[\w\-\.]+[^#?\s]+)(?:.*)?(?:#[\w\-]+)?$/)){ap=ao
}}if(ap&&J){ao=J(ap)||""}if(!ao.length&&ap){ao='<video src="'+z(ap)+'" />'}ag.insertHTML(ao).closePopup().collapseSelection()};var ah=e("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");var ai=e("<textarea>").addClass("wysiwyg-input wysiwyg-inputtextarea");if(C){ai.attr("placeholder",C)}e("<div/>").addClass("wysiwyg-embedcode").append(ai).appendTo(ah);var al=U(E);var am=e('<input type="text" value="" />').addClass("wysiwyg-input").keypress(function(an){if(an.which==10||an.which==13){aj(am.val())}});if(ad){am.attr("placeholder",ad)}var ak=al.click(function(an){aj(am.val(),ai.val());an.stopPropagation();an.preventDefault();return false});ah.append(e("<div/>").append(am).append(ak));return ah};var N=function(ah,aj){var ag=e("<table/>").attr("cellpadding","0").attr("cellspacing","0").attr("unselectable","on");for(var ar=1;ar<15;++ar){var ap=e("<tr/>");for(var ai=0;ai<25;++ai){var ak;if(ai==24){var aq=Math.floor(255/13*(14-ar)).toString(16);var an=(aq.length<2?"0":"")+aq;ak="#"+an+an+an}else{var am=ai/24;var al=ar<=8?ar/8:1;var ao=ar>8?(16-ar)/8:1;ak=g(am,al,ao)}e("<td/>").addClass("wysiwyg-toolbar-color").attr("title",ak).attr("unselectable","on").css({backgroundColor:ak}).click(function(){var at=this.title;if(aj){ah.forecolor(at).closePopup().collapseSelection()}else{ah.highlight(at).closePopup().collapseSelection()}return false}).appendTo(ap)}ag.append(ap)}return ag};var Q=function(ag,ah){switch(ag){case"insertimage":if(!ah){return null}return function(ai){ah(T(B),ai)};case"insertvideo":if(!ah){return null}return function(ai){ah(ac(B),ai)};case"insertlink":if(!ah){return null}return function(ai){ah(aa(B),ai)};case"bold":return function(){B.bold()};case"italic":return function(){B.italic()};case"underline":return function(){B.underline()};case"strikethrough":return function(){B.strikethrough()};case"forecolor":if(!ah){return null}return function(ai){ah(N(B,true),ai)};case"highlight":if(!ah){return null}return function(ai){ah(N(B,false),ai)};case"alignleft":return function(){B.align("left")};case"aligncenter":return function(){B.align("center")};case"alignright":return function(){B.align("right")};case"alignjustify":return function(){B.align("justify")};case"subscript":return function(){B.subscript()};case"superscript":return function(){B.superscript()};case"indent":return function(){B.indent()};case"outdent":return function(){B.indent(true)};case"orderedList":return function(){B.insertList(true)};case"unorderedList":return function(){B.insertList()};case"removeformat":return function(){B.removeFormat().closePopup().collapseSelection()}}return null};var U=function(ag){return e("<a/>").addClass("wysiwyg-toolbar-icon").attr("href","#").attr("title",ag.title).attr("unselectable","on").append(ag.image)};var W=function(ag,ah,ai,aj){e.each(Y,function(ak,an){if(!an){return}if(ah===false&&"showstatic" in an&&!an.showstatic){return}if(ah===true&&"showselection" in an&&!an.showselection){return}var am;if("click" in an){am=function(ao){an.click(e(ao))}}else{if("popup" in an){am=function(ap){var aq=ai();var ao=an.popup(aq,e(ap));aj(aq,ap,ao)}}else{am=Q(ak,function(ao,ap){var aq=ai();aq.append(ao);aj(aq,ap);aq.find("input[type=text]:first").focus()})}}var al;if(am){al=U(an).click(function(ao){am(ao.currentTarget);if(Q(ak)){B.getElement().focus()}ao.stopPropagation();ao.preventDefault();return false})}else{if(an.html){al=e(an.html)}}if(al){ag.append(al)}})};var af=function(ag,av,ak,ar){var au=av.get(0).offsetParent,am={left:0,top:0},ap=false,ah=false,at=ag.width(),aj=au;while(aj){am.left+=aj.offsetLeft;am.top+=aj.offsetTop;var ai=e(aj);if(ai.css("position")=="fixed"){ap=true}if(ai.css("overflow")!="visible"){ah=true}aj=aj.offsetParent}var aq=e(au||t.body);aq.append(ag);var al=av.position();ak+=al.left;ar+=al.top;if(ap||ah){if(ak+at>aq.width()-1){ak=aq.width()-at-1}if(ak<1){ak=1}}var ao=e(l).width();if(am.left+ak+at>ao-1){ak=ao-am.left-at-1}var an=ap?0:e(l).scrollLeft();if(am.left+ak<an+1){ak=an-am.left+1}ag.css({left:parseInt(ak)+"px",top:parseInt(ar)+"px"})};var L={};var P=function(al,ak,aj){var ai={element:al.get(0),onkeypress:function(ao,aq,an,ap,at,ar){if(ab&&ab(ao,aq,an,ap,at,ar)===false){return false
}if(aq&&!an&&!ap&&at&&!ar){var am=aq.toLowerCase();if(!L[am]){return}L[am]();return false}},onselection:function(au,aq,an,ao){var ap=true,am=null;if(au){e.each(an,function(av,aw){if(e(aw).parents("a").length!=0){am=aa(ag,e(aw).parents("a:first"));return false}})}if(!aq){ap=false}else{if(am){}else{if(ao){}else{if(F!="selection"&&F!="top-selection"&&F!="bottom-selection"){ap=false}else{if(au){ap=false}else{if(an.length==1&&an[0].nodeName=="IMG"){ap=false}}}}}}if(!ap){ag.closePopup();return}var at;var ar=function(){var az=at.outerWidth();var ay=ak.offset(),av=e(ag.getElement()).offset();var ax=aq.left+parseInt(aq.width/2)-parseInt(az/2)+av.left-ay.left;var aw=aq.top+aq.height+av.top-ay.top;af(at,ak,ax,aw)};at=e(ag.openPopup());if(at.hasClass("wysiwyg-popup")&&!at.hasClass("wysiwyg-popuphover")||at.data("special")!=(!!am)){at=e(ag.closePopup().openPopup())}if(!at.hasClass("wysiwyg-popup")){at.addClass("wysiwyg-popup wysiwyg-popuphover");if(am){at.empty().append(am).data("special",true)}else{W(at,true,function(){return at.empty()},ar)}}ar()},hijackcontextmenu:(F=="selection")};if(aj){var ah=e("<div/>").addClass("wysiwyg-placeholder").html(aj).hide();ak.prepend(ah);ai.onplaceholder=function(am){if(am){ah.show()}else{ah.hide()}}}var ag=b(ai);return ag};var R=e("<div/>").addClass("wysiwyg-container");if(Z){R.addClass(Z)}X.wrap(R);R=X.parent(".wysiwyg-container");var S=false;if(H){S=e("<div/>").addClass("wysiwyg-wrapper").click(function(){B.getElement().focus()});X.wrap(S);S=X.parent(".wysiwyg-wrapper")}var B=P(X,H?S:R,H);if(B.legacy){var X=e(B.getElement());X.addClass("wysiwyg-textarea");if(X.is(":visible")){X.width(R.width()-(X.outerWidth()-X.width()))}}else{e(B.getElement()).addClass("wysiwyg-editor")}var G={};e.each(Y,function(ag,ai){if(!ai||!ai.hotkey){return}var ah=Q(ag);if(!ah){return}L[ai.hotkey.toLowerCase()]=ah;G[ag]=ah});if(F!="selection"){var K=F=="top"||F=="top-selection";var ae=e("<div/>").addClass("wysiwyg-toolbar").addClass(K?"wysiwyg-toolbar-top":"wysiwyg-toolbar-bottom");W(ae,false,function(){var ag=e(B.openPopup());if(ag.hasClass("wysiwyg-popup")&&ag.hasClass("wysiwyg-popuphover")){ag=e(B.closePopup().openPopup())}if(!ag.hasClass("wysiwyg-popup")){ag.addClass("wysiwyg-popup")}return ag},function(al,ak,ag){var ah=e(ak);var am=al.outerWidth();var aj=ah.offset().left-R.offset().left+parseInt(ah.width()/2)-parseInt(am/2);var ai=ah.offset().top-R.offset().top;if(K){ai+=ah.outerHeight()}else{ai-=al.outerHeight()}if(ag){aj=ag.left;ai=ag.top}af(al,R,aj,ai)});if(K){R.prepend(ae)}else{R.append(ae)}}return{wysiwygeditor:B,$container:R}};e.fn.wysiwyg=function(B,D){if(!B||typeof(B)==="object"){B=e.extend({},B);return this.each(function(){var K=e(this);if(K.data("wysiwyg")){return}var H=B.classes,Q=B.placeholder||K.attr("placeholder"),F=(B.toolbar&&(B.toolbar=="top"||B.toolbar=="top-selection"||B.toolbar=="bottom"||B.toolbar=="bottom-selection"||B.toolbar=="selection"))?B.toolbar:"top-selection",I=B.buttons,P=B.submit,R=B.selectImage,S=B.placeholderUrl||null,O=B.placeholderEmbed||null,E=B.maxImageSize||null,M=B.onImageUpload||null,G=B.forceImageUpload&&M,N=B.videoFromUrl||null,L=B.onKeyPress;var J=r(K,H,Q,F,I,P,R,S,O,E,M,G,N,L);K.data("wysiwyg",J)})}else{if(this.length==1){var C=this.data("wysiwyg");if(!C){return this}if(B=="container"){return C.$container}if(B=="shell"){return C.wysiwygeditor}}}return this}}));