(function(i,p,a,d){var c=function(z,y,w){var x;return function(){if(x){if(!w){return}clearTimeout(x)}var B=this,A=arguments;x=setTimeout(function(){x=null;z.apply(B,A)},y)}};var q=function(x,z,y,w){if(x.addEventListener){x.addEventListener(z,y,w?true:false)}else{if(x.attachEvent){x.attachEvent("on"+z,y)}else{if(x!=i){x["on"+z]=y}}}};var s=function(x,z,y,w){if(x.removeEventListener){x.removeEventListener(z,y,w?true:false)}else{if(x.detachEvent){x.detachEvent("on"+z,y)}else{if(x!=i){x["on"+z]=null}}}};var v=function(y,z,x,w){if(p.createEvent){var A=p.createEvent("Event");A.initEvent(z,x!==d?x:true,w!==d?w:false);y.dispatchEvent(A)}else{if(p.createEventObject){var A=p.createEventObject();y.fireEvent("on"+z,A)}else{if(typeof(y["on"+z])=="function"){y["on"+z]()}}}};var t=function(w){if(w.preventDefault){w.preventDefault()}else{w.returnValue=false}if(w.stopPropagation){w.stopPropagation()}else{w.cancelBubble=true}return false};var n=typeof(Node)!="undefined"?Node.ELEMENT_NODE:1;var f=typeof(Node)!="undefined"?Node.TEXT_NODE:3;var l=function(w,x){var y=x;while(y){if(y===w){return true}y=y.parentNode}return false};var b=function(x,w){if(x.firstChild){return x.firstChild}while(x){if(x==w){return null}if(x.nextSibling){return x.nextSibling}x=x.parentNode}return null};var o=function(w){if(i.getSelection){var x=i.getSelection();if(x.rangeCount>0){return x.getRangeAt(0)}}else{if(p.selection){var x=p.selection;return x.createRange()}}return null};var k=function(w,y){if(!y){return}if(i.getSelection){var x=i.getSelection();x.removeAllRanges();x.addRange(y)}else{if(p.selection){y.select()}}};var g=function(){if(i.getSelection){var y=i.getSelection();if(!y.rangeCount){return false}var w=y.getRangeAt(0).cloneRange();if(w.getBoundingClientRect){var x=w.getBoundingClientRect();if(!x||(x.left==0&&x.top==0&&x.right==0&&x.bottom==0)){return false}return{left:parseInt(x.left),top:parseInt(x.top),width:parseInt(x.right-x.left),height:parseInt(x.bottom-x.top)}}}else{if(p.selection){var y=p.selection;if(y.type!="Control"){var w=y.createRange();return{left:w.boundingLeft,top:w.boundingTop,width:w.boundingWidth,height:w.boundingHeight}}}}return false};var h=function(x){if(i.getSelection){var z=i.getSelection();if(z.isCollapsed){return true}return false}else{if(p.selection){var z=p.selection;if(z.type=="Text"){var y=p.selection.createRange();var w=p.body.createTextRange();w.moveToElementText(x);w.setEndPoint("EndToStart",y);return y.htmlText.length==0}if(z.type=="Control"){return false}}}return true};var j=function(A){if(i.getSelection){var y=i.getSelection();if(!y.rangeCount){return[]}var x=[];for(var E=0;E<y.rangeCount;++E){var G=y.getRangeAt(E),z=G.startContainer,H=G.endContainer;while(z){if(z!=A){var I=false;if(y.containsNode){I=y.containsNode(z,true)}else{var D=p.createRange();D.selectNodeContents(z);for(var E=0;E<y.rangeCount;++E){var G=y.getRangeAt(E);if(G.compareBoundaryPoints(G.END_TO_START,D)>=0&&G.compareBoundaryPoints(G.START_TO_END,D)<=0){I=true;break}}}if(I){x.push(z)}}z=b(z,z==H?H:A)}}if(x.length==0&&l(A,y.focusNode)&&y.focusNode!=A){x.push(y.focusNode)}return x}else{if(p.selection){var y=p.selection;if(y.type=="Text"){var x=[];var w=y.createRangeCollection();for(var E=0;E<w.length;++E){var G=w[E],F=G.parentElement(),z=F;while(z){var D=G.duplicate();D.moveToElementText(z.nodeType!=n?z.parentNode:z);if(D.compareEndPoints("EndToStart",G)>=0&&D.compareEndPoints("StartToEnd",G)<=0){var C=false;for(var B=0;B<x.length;++B){if(x[B]!==z){continue}C=true;break}if(!C){x.push(z)}}z=b(z,F)}}if(x.length==0&&l(A,p.activeElement)&&p.activeElement!=A){x.push(p.activeElement)}return x}if(y.type=="Control"){var x=[];var G=y.createRange();for(var E=0;E<G.length;++E){x.push(G(E))}return x}}}return[]};var e=function(){if(i.getSelection){var x=i.getSelection();if(!x.isCollapsed){try{x.collapseToEnd()}catch(y){}}}else{if(p.selection){var x=p.selection;if(x.type!="Control"){var w=x.createRange();w.collapse(false);w.select()}}}};var r=function(x){if(h(x)){return null}if(i.getSelection){var C=i.getSelection();if(C.rangeCount){var y=p.createElement("div"),w=C.rangeCount;
for(var A=0;A<w;++A){var B=C.getRangeAt(A).cloneContents();y.appendChild(B)}return y.innerHTML}}else{if(p.selection){var C=p.selection;if(C.type=="Text"){var z=C.createRange();return z.htmlText}}}return null};var m=function(w,A){if(i.getSelection){var z=i.getSelection();if(l(w,z.anchorNode)&&l(w,z.focusNode)){return true}if(!A){return false}var x=p.createRange();x.selectNodeContents(w);x.collapse(false);z.removeAllRanges();z.addRange(x)}else{if(p.selection){var z=p.selection;if(z.type=="Control"){var x=z.createRange();if(x.length!=0&&l(w,x(0))){return true}}else{var y=p.body.createTextRange();y.moveToElementText(w);var x=z.createRange();if(y.inRange(x)){return true}}if(!A){return false}var x=p.body.createTextRange();x.moveToElementText(w);x.setEndPoint("StartToEnd",x);x.select()}}return true};var u=function(A,C){if(i.getSelection){var x=i.getSelection();if(x.getRangeAt&&x.rangeCount){var D=x.getRangeAt(0);var y=p.createElement("div");y.innerHTML=C;var E=p.createDocumentFragment(),z,w;while((z=y.firstChild)){w=E.appendChild(z)}if(l(A,D.commonAncestorContainer)){D.deleteContents();D.insertNode(E)}else{A.appendChild(E)}if(w){D=D.cloneRange();D.setStartAfter(w);D.collapse(true);x.removeAllRanges();x.addRange(D)}}}else{if(p.selection){var x=p.selection;if(x.type!="Control"){var B=x.createRange();B.collapse(true);var D=x.createRange();if(l(A,D.parentElement())){D.pasteHTML(C)}else{var F=p.body.createTextRange();F.moveToElementText(A);F.collapse(false);F.select();F.pasteHTML(C)}D=x.createRange();D.setEndPoint("StartToEnd",B);D.select()}}}};i.wysiwyg=function(V){V=V||{};var P=V.element||null;if(typeof(P)=="string"){P=p.getElementById(P)}var ab=V.onkeypress||null;var N=V.onselection||null;var W=V.onplaceholder||null;var Y=V.hijackcontextmenu||false;var M=P.nodeName=="TEXTAREA"||P.nodeName=="INPUT";if(M){var U="contentEditable" in p.body;if(U){var D=a.userAgent.match(/(?:iPad|iPhone|Android).* AppleWebKit\/([^ ]+)/);if(D&&420<=parseInt(D[1])&&parseInt(D[1])<534){U=false}}if(!U){var G=P;var Z=function(ah){return ah.replace(/<br[ \/]*>\n?/gi,"<br>\n")};G.value=Z(G.value);var ae=function(){return this};var y=function(){return null};return{legacy:true,getElement:function(){return G},getHTML:function(){return G.value},setHTML:function(ah){G.value=Z(ah);return this},getSelectedHTML:y,sync:ae,collapseSelection:ae,openPopup:y,closePopup:ae,removeFormat:ae,bold:ae,italic:ae,underline:ae,strikethrough:ae,forecolor:ae,highlight:ae,fontName:ae,fontSize:ae,subscript:ae,superscript:ae,align:ae,format:ae,indent:ae,insertLink:ae,insertImage:ae,insertHTML:ae,insertList:ae}}}var G=null,ag=null;if(M){G=P;G.style.display="none";ag=p.createElement("DIV");ag.innerHTML=G.value;var I=G.parentNode,x=G.nextSibling;if(x){I.insertBefore(ag,x)}else{I.appendChild(ag)}}else{ag=P}ag.setAttribute("contentEditable","true");var L=(p.all&&!p.addEventListener)?p:i;var O=null;if(M){var E=ag.innerHTML;O=function(){var ah=ag.innerHTML;if(ah==E){return}G.value=ah;E=ah;v(G,"change",false)}}var T;if(W){var K=false;T=function(){var aj=true;var ah=ag;while(ah){ah=b(ah,ag);if(!ah){}else{if(ah.nodeType==n){if(ah.nodeName=="IMG"){aj=false;break}}else{if(ah.nodeType==f){var ai=ah.nodeValue;if(ai&&ai.search(/[^\s]/)!=-1){aj=false;break}}}}}if(K!=aj){W(aj);K=aj}};T()}var R=null,C=null,Q=null;if(N){C=function(ak,ai,at){var ap=h(ag);var aj=j(ag);var ar=(ak===null||ai===null)?null:{left:ak,top:ai,width:0,height:0};var ah=g();if(ah){ar=ah}if(ar){if(ag.getBoundingClientRect){var au=ag.getBoundingClientRect();ar.left-=parseInt(au.left);ar.top-=parseInt(au.top)}else{var an=ag,am=0,al=0,ao=false;do{am+=an.offsetLeft?parseInt(an.offsetLeft):0;al+=an.offsetTop?parseInt(an.offsetTop):0;if(an.style.position=="fixed"){ao=true}}while(an=an.offsetParent);ar.left-=am-(ao?0:i.pageXOffset);ar.top-=al-(ao?0:i.pageYOffset)}if(ar.left<0){ar.left=0}if(ar.top<0){ar.top=0}if(ar.width>ag.offsetWidth){ar.width=ag.offsetWidth}if(ar.height>ag.offsetHeight){ar.height=ag.offsetHeight}}else{if(aj.length){for(var aq=0;aq<aj.length;++aq){var an=aj[aq];if(an.nodeType!=n){continue}ar={left:an.offsetLeft,top:an.offsetTop,width:an.offsetWidth,height:an.offsetHeight};
break}}}N(ap,ar,aj,at)};Q=c(C,1)}var aa=null;var B=function(ai){if(!ai){var ai=i.event}var ah=ai.target||ai.srcElement;if(ah.nodeType==f){ah=ah.parentNode}if(l(aa,ah)){return}af()};var X=function(){if(aa){return aa}q(L,"mousedown",B,true);aa=p.createElement("DIV");var ai=ag.parentNode,ah=ag.nextSibling;if(ah){ai.insertBefore(aa,ah)}else{ai.appendChild(aa)}return aa};var af=function(){if(!aa){return}aa.parentNode.removeChild(aa);aa=null;s(L,"mousedown",B,true)};q(ag,"focus",function(){if(G){v(G,"focus",false)}});q(ag,"blur",function(){if(O){O()}if(G){v(G,"blur",false)}});var z=null;if(T||O){var A=O?c(O,250,true):null;var ac=function(ah){if(T){T()}if(A){A()}};z=c(ac,1);q(ag,"input",z);q(ag,"DOMNodeInserted",z);q(ag,"DOMNodeRemoved",z);q(ag,"DOMSubtreeModified",z);q(ag,"DOMCharacterDataModified",z);q(ag,"propertychange",z);q(ag,"textInput",z);q(ag,"paste",z);q(ag,"cut",z);q(ag,"drop",z)}var H=function(ak,ah){if(!ak){var ak=i.event}var ai=0;if(ak.keyCode){ai=ak.keyCode}else{if(ak.which){ai=ak.which}}var aj=ak.charCode;if(ah==1&&ab){var al=ab(ai,aj?String(String):String.fromCharCode(ai),ak.shiftKey||false,ak.altKey||false,ak.ctrlKey||false,ak.metaKey||false);if(al===false){return t(ak)}}if(ah==2||ah==3){R=null;if(Q){Q(null,null,false)}}if(ah==2&&z){switch(ai){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:break;default:z();break}}};q(ag,"keydown",function(ah){return H(ah,1)});q(ag,"keypress",function(ah){return H(ah,2)});q(ag,"keyup",function(ah){return H(ah,3)});var ad=function(ak,ah){if(!ak){var ak=i.event}var aj=null,ai=null;if(ak.clientX&&ak.clientY){aj=ak.clientX;ai=ak.clientY}else{if(ak.pageX&&ak.pageY){aj=ak.pageX-i.pageXOffset;ai=ak.pageY-i.pageYOffset}}if(ak.which&&ak.which==3){ah=true}else{if(ak.button&&ak.button==2){ah=true}}s(L,"mouseup",ad);R=null;if(!Y&&ah){return}if(Q){Q(aj,ai,ah)}};q(ag,"mousedown",function(ah){s(L,"mouseup",ad);q(L,"mouseup",ad)});q(ag,"mouseup",function(ah){ad(ah);if(z){z()}});q(ag,"dblclick",function(ah){ad(ah)});q(ag,"selectionchange",function(ah){ad(ah)});if(Y){q(ag,"contextmenu",function(ah){ad(ah,true);return t(ah)})}var w=function(am,al,aj){k(ag,R);if(!m(ag,aj)){return false}if(i.getSelection){try{if(p.queryCommandSupported&&!p.queryCommandSupported(am)){return false}return p.execCommand(am,false,al)}catch(ak){}}else{if(p.selection){var ai=p.selection;if(ai.type!="None"){var ah=ai.createRange();try{if(!ah.queryCommandEnabled(am)){return false}return ah.execCommand(am,false,al)}catch(ak){}}}}return false};var F=null;var J=function(){if(p.all||!!i.MSInputMethodContext){F=p.createElement("DIV");ag.appendChild(F)}};var S=function(ah){if(F){ag.removeChild(F);F=null}if(z){z()}if(ah){e();R=null}else{if(R){R=o(ag)}}};return{getElement:function(){return ag},getHTML:function(){return ag.innerHTML},setHTML:function(ah){ag.innerHTML=ah;S(true);return this},getSelectedHTML:function(){k(ag,R);if(!m(ag)){return null}return r(ag)},sync:function(){if(O){O()}return this},collapseSelection:function(){e();R=null;return this},openPopup:function(){if(!R){R=o(ag)}return X()},closePopup:function(){af();return this},removeFormat:function(){w("removeFormat");w("unlink");S();return this},bold:function(){w("bold");S();return this},italic:function(){w("italic");S();return this},underline:function(){w("underline");S();return this},strikethrough:function(){w("strikeThrough");S();return this},forecolor:function(ah){w("foreColor",ah);S();return this},highlight:function(ah){if(!w("hiliteColor",ah)){w("backColor",ah)}S();return this},fontName:function(ah){w("fontName",ah);S();return this},fontSize:function(ah){w("fontSize",ah);S();return this},subscript:function(){w("subscript");S();return this},superscript:function(){w("superscript");S();return this},align:function(ah){J();if(ah=="left"){w("justifyLeft")}else{if(ah=="center"){w("justifyCenter")}else{if(ah=="right"){w("justifyRight")}else{if(ah=="justify"){w("justifyFull")}}}}S();return this},format:function(ah){J();w("formatBlock",ah);S();return this},indent:function(ah){J();w(ah?"outdent":"indent");S();return this},insertLink:function(ah){w("createLink",ah);
S(true);return this},insertImage:function(ah){w("insertImage",ah,true);S(true);return this},insertHTML:function(ah){if(!w("insertHTML",ah,true)){k(ag,R);m(ag,true);u(ag,ah)}S(true);return this},insertList:function(ah){J();w(ah?"insertOrderedList":"insertUnorderedList");S();return this}}}})(window,document,navigator);
(function(e,a,f,g){var c=function(o,C,A){var j,u,y,n,x,l,k,B;n=Math.floor(o*6);x=o*6-n;l=A*(1-C);k=A*(1-x*C);B=A*(1-(1-x)*C);switch(n%6){case 0:j=A,u=B,y=l;break;case 1:j=k,u=A,y=l;break;case 2:j=l,u=A,y=B;break;case 3:j=l,u=k,y=A;break;case 4:j=B,u=l,y=A;break;case 5:j=A,u=l,y=k;break}var z=Math.floor(j*255).toString(16);var m=Math.floor(u*255).toString(16);var w=Math.floor(y*255).toString(16);return"#"+(z.length<2?"0":"")+z+(m.length<2?"0":"")+m+(w.length<2?"0":"")+w};var d=function(h){return h.replace(/[&<>"]/g,function(i){var j={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};return j[i]||i})};var b=function(D,F,n,l,E,k,u,J,i,s,o,j,p,H){var B=function(M,N){if(!N){}else{if(M.getSelectedHTML()){M.insertLink(N)}else{M.insertHTML('<a href="'+d(N)+'">'+d(N)+"</a>")}}M.closePopup().collapseSelection()};var G=function(M,Q){var P=A(k);var R=f('<input type="text" value="'+(Q?Q.attr("href"):"")+'" />').addClass("wysiwyg-input").keypress(function(S){if(S.which!=10&&S.which!=13){return}if(Q){Q.attr("href",R.val());M.closePopup().collapseSelection()}else{B(M,R.val())}});if(J){R.attr("placeholder",J)}var O=P.click(function(S){if(Q){Q.attr("href",R.val());M.closePopup().collapseSelection()}else{B(M,R.val())}S.stopPropagation();S.preventDefault();return false});var N=f("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");N.append(R).append(O);return N};var z=function(Q){var O=function(X,W){var Y='<img id="wysiwyg-insert-image" src="" alt=""'+(W?' title="'+d(W)+'"':"")+" />";Q.insertHTML(Y).closePopup().collapseSelection();var Z=f("#wysiwyg-insert-image").removeAttr("id");if(s){Z.css({maxWidth:s[0]+"px",maxHeight:s[1]+"px"}).load(function(){Z.css({maxWidth:"",maxHeight:""});var ab=Z.width(),aa=Z.height();if(ab>s[0]||aa>s[1]){if((ab/aa)>(s[0]/s[1])){aa=parseInt(aa/ab*s[0]);ab=s[0]}else{ab=parseInt(ab/aa*s[1]);aa=s[1]}Z.attr("width",ab).attr("height",aa)}})}Z.attr("src",X)};var P=f("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");var T=null,V=f('<input type="file" />').css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0,cursor:"pointer"});if(!j&&e.File&&e.FileReader&&e.FileList){var R=function(X){if(!X.type.match("image.*")){return}var W=new FileReader();W.onload=function(Z){var Y=Z.target.result;O(Y,X.name)};W.readAsDataURL(X)};T=V.attr("draggable","true").change(function(Y){var X=Y.target.files;for(var W=0;W<X.length;++W){R(X[W])}}).on("dragover",function(W){W.originalEvent.dataTransfer.dropEffect="copy";W.stopPropagation();W.preventDefault();return false}).on("drop",function(Y){var X=Y.originalEvent.dataTransfer.files;for(var W=0;W<X.length;++W){R(X[W])}Y.stopPropagation();Y.preventDefault();return false})}else{if(o){var U=V.change(function(W){o.call(this,O)});T=f("<form/>").append(U)}}if(T){f("<div/>").addClass("wysiwyg-browse").html(u).append(T).appendTo(P)}var M=A(k);var S=f('<input type="text" value="" />').addClass("wysiwyg-input").keypress(function(W){if(W.which==10||W.which==13){O(S.val())}});if(J){S.attr("placeholder",J)}var N=M.click(function(W){O(S.val());W.stopPropagation();W.preventDefault();return false});P.append(f("<div/>").append(S).append(N));return P};var I=function(M){var P=function(T,U){T=f.trim(T||"");U=f.trim(U||"");var V=false;if(T.length&&!U.length){V=T}else{if(U.indexOf("<")==-1&&U.indexOf(">")==-1&&U.match(/^(?:https?:\/)?\/?(?:[^:\/\s]+)(?:(?:\/\w+)*\/)(?:[\w\-\.]+[^#?\s]+)(?:.*)?(?:#[\w\-]+)?$/)){V=U}}if(V&&p){U=p(V)||""}if(!U.length&&V){U='<video src="'+d(V)+'" />'}M.insertHTML(U).closePopup().collapseSelection()};var N=f("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");var O=f("<textarea>").addClass("wysiwyg-input wysiwyg-inputtextarea");if(i){O.attr("placeholder",i)}f("<div/>").addClass("wysiwyg-embedcode").append(O).appendTo(N);var R=A(k);var S=f('<input type="text" value="" />').addClass("wysiwyg-input").keypress(function(T){if(T.which==10||T.which==13){P(S.val())}});if(J){S.attr("placeholder",J)}var Q=R.click(function(T){P(S.val(),O.val());T.stopPropagation();T.preventDefault();return false});N.append(f("<div/>").append(S).append(Q));
return N};var t=function(N,P){var M=f("<table/>").attr("cellpadding","0").attr("cellspacing","0").attr("unselectable","on");for(var X=1;X<15;++X){var V=f("<tr/>");for(var O=0;O<25;++O){var Q;if(O==24){var W=Math.floor(255/13*(14-X)).toString(16);var T=(W.length<2?"0":"")+W;Q="#"+T+T+T}else{var S=O/24;var R=X<=8?X/8:1;var U=X>8?(16-X)/8:1;Q=c(S,R,U)}f("<td/>").addClass("wysiwyg-toolbar-color").attr("title",Q).attr("unselectable","on").css({backgroundColor:Q}).click(function(){var Y=this.title;if(P){N.forecolor(Y).closePopup().collapseSelection()}else{N.highlight(Y).closePopup().collapseSelection()}return false}).appendTo(V)}M.append(V)}return M};var w=function(M,N){switch(M){case"insertimage":if(!N){return null}return function(O){N(z(h),O)};case"insertvideo":if(!N){return null}return function(O){N(I(h),O)};case"insertlink":if(!N){return null}return function(O){N(G(h),O)};case"bold":return function(){h.bold()};case"italic":return function(){h.italic()};case"underline":return function(){h.underline()};case"strikethrough":return function(){h.strikethrough()};case"forecolor":if(!N){return null}return function(O){N(t(h,true),O)};case"highlight":if(!N){return null}return function(O){N(t(h,false),O)};case"alignleft":return function(){h.align("left")};case"aligncenter":return function(){h.align("center")};case"alignright":return function(){h.align("right")};case"alignjustify":return function(){h.align("justify")};case"subscript":return function(){h.subscript()};case"superscript":return function(){h.superscript()};case"indent":return function(){h.indent()};case"outdent":return function(){h.indent(true)};case"orderedList":return function(){h.insertList(true)};case"unorderedList":return function(){h.insertList()};case"removeformat":return function(){h.removeFormat().closePopup().collapseSelection()}}return null};var A=function(M){return f("<a/>").addClass("wysiwyg-toolbar-icon").attr("href","#").attr("title",M.title).attr("unselectable","on").append(M.image)};var C=function(M,N,O,P){f.each(E,function(Q,T){if(!T){return}if(N===false&&"showstatic" in T&&!T.showstatic){return}if(N===true&&"showselection" in T&&!T.showselection){return}var S;if("click" in T){S=function(U){T.click(f(U))}}else{if("popup" in T){S=function(V){var W=O();var U=T.popup(W,f(V));P(W,V,U)}}else{S=w(Q,function(U,V){var W=O();W.append(U);P(W,V);W.find("input[type=text]:first").focus()})}}var R;if(S){R=A(T).click(function(U){S(U.currentTarget);if(w(Q)){h.getElement().focus()}U.stopPropagation();U.preventDefault();return false})}else{if(T.html){R=f(T.html)}}if(R){M.append(R)}})};var L=function(M,aa,Q,X){var Z=aa.get(0).offsetParent,S={left:0,top:0},V=false,N=false,Y=M.width(),P=Z;while(P){S.left+=P.offsetLeft;S.top+=P.offsetTop;var O=f(P);if(O.css("position")=="fixed"){V=true}if(O.css("overflow")!="visible"){N=true}P=P.offsetParent}var W=f(Z||a.body);W.append(M);var R=aa.position();Q+=R.left;X+=R.top;if(V||N){if(Q+Y>W.width()-1){Q=W.width()-Y-1}if(Q<1){Q=1}}var U=f(e).width();if(S.left+Q+Y>U-1){Q=U-S.left-Y-1}var T=V?0:f(e).scrollLeft();if(S.left+Q<T+1){Q=T-S.left+1}M.css({left:parseInt(Q)+"px",top:parseInt(X)+"px"})};var r={};var v=function(R,Q,P){var O={element:R.get(0),onkeypress:function(U,W,T,V,Y,X){if(H&&H(U,W,T,V,Y,X)===false){return false}if(W&&!T&&!V&&Y&&!X){var S=W.toLowerCase();if(!r[S]){return}r[S]();return false}},onselection:function(Z,W,T,U){var V=true,S=null;if(Z){f.each(T,function(aa,ab){if(f(ab).parents("a").length!=0){S=G(M,f(ab).parents("a:first"));return false}})}if(!W){V=false}else{if(S){}else{if(U){}else{if(l!="selection"&&l!="top-selection"&&l!="bottom-selection"){V=false}else{if(Z){V=false}else{if(T.length==1&&T[0].nodeName=="IMG"){V=false}}}}}}if(!V){M.closePopup();return}var Y;var X=function(){var ae=Y.outerWidth();var ad=Q.offset(),aa=f(M.getElement()).offset();var ac=W.left+parseInt(W.width/2)-parseInt(ae/2)+aa.left-ad.left;var ab=W.top+W.height+aa.top-ad.top;L(Y,Q,ac,ab)};Y=f(M.openPopup());if(Y.hasClass("wysiwyg-popup")&&!Y.hasClass("wysiwyg-popuphover")||Y.data("special")!=(!!S)){Y=f(M.closePopup().openPopup())}if(!Y.hasClass("wysiwyg-popup")){Y.addClass("wysiwyg-popup wysiwyg-popuphover");
if(S){Y.empty().append(S).data("special",true)}else{C(Y,true,function(){return Y.empty()},X)}}X()},hijackcontextmenu:(l=="selection")};if(P){var N=f("<div/>").addClass("wysiwyg-placeholder").html(P).hide();Q.prepend(N);O.onplaceholder=function(S){if(S){N.show()}else{N.hide()}}}var M=wysiwyg(O);return M};var x=f("<div/>").addClass("wysiwyg-container");if(F){x.addClass(F)}D.wrap(x);x=D.parent(".wysiwyg-container");var y=false;if(n){y=f("<div/>").addClass("wysiwyg-wrapper").click(function(){h.getElement().focus()});D.wrap(y);y=D.parent(".wysiwyg-wrapper")}var h=v(D,n?y:x,n);if(h.legacy){var D=f(h.getElement());D.addClass("wysiwyg-textarea");if(D.is(":visible")){D.width(x.width()-(D.outerWidth()-D.width()))}}else{f(h.getElement()).addClass("wysiwyg-editor")}var m={};f.each(E,function(M,O){if(!O||!O.hotkey){return}var N=w(M);if(!N){return}r[O.hotkey.toLowerCase()]=N;m[M]=N});if(l!="selection"){var q=l=="top"||l=="top-selection";var K=f("<div/>").addClass("wysiwyg-toolbar").addClass(q?"wysiwyg-toolbar-top":"wysiwyg-toolbar-bottom");C(K,false,function(){var M=f(h.openPopup());if(M.hasClass("wysiwyg-popup")&&M.hasClass("wysiwyg-popuphover")){M=f(h.closePopup().openPopup())}if(!M.hasClass("wysiwyg-popup")){M.addClass("wysiwyg-popup")}return M},function(R,Q,M){var N=f(Q);var S=R.outerWidth();var P=N.offset().left-x.offset().left+parseInt(N.width()/2)-parseInt(S/2);var O=N.offset().top-x.offset().top;if(q){O+=N.outerHeight()}else{O-=R.outerHeight()}if(M){P=M.left;O=M.top}L(R,x,P,O)});if(q){x.prepend(K)}else{x.append(K)}}return{wysiwygeditor:h,$container:x}};f.fn.wysiwyg=function(h,j){if(!h||typeof(h)==="object"){h=f.extend({},h);return this.each(function(){var q=f(this);if(q.data("wysiwyg")){return}var n=h.classes,w=h.placeholder||q.attr("placeholder"),l=(h.toolbar&&(h.toolbar=="top"||h.toolbar=="top-selection"||h.toolbar=="bottom"||h.toolbar=="bottom-selection"||h.toolbar=="selection"))?h.toolbar:"top-selection",o=h.buttons,v=h.submit,x=h.selectImage,y=h.placeholderUrl||null,u=h.placeholderEmbed||null,k=h.maxImageSize||null,s=h.onImageUpload||null,m=h.forceImageUpload&&s,t=h.videoFromUrl||null,r=h.onKeyPress;var p=b(q,n,w,l,o,v,x,y,u,k,s,m,t,r);q.data("wysiwyg",p)})}else{if(this.length==1){var i=this.data("wysiwyg");if(!i){return this}if(h=="container"){return i.$container}if(h=="shell"){return i.wysiwygeditor}}}return this}})(window,document,jQuery);